FROM amd64/node:9.5.0-alpine AS build

ENV NODE_ENV=build
WORKDIR /build

COPY package.json yarn.lock /build/
RUN yarn install

COPY . /build/
RUN yarn build && \
    yarn install --production --no-optional && \
    mkdir /app && \
    mv package.json yarn.lock node_modules dist tests .babelrc /app

FROM amd64/node:9.5.0-alpine

ENV NODE_ENV=production
WORKDIR /app

COPY --from=build /app /app

CMD ["yarn","start"]
