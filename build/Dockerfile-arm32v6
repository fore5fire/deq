FROM arm32v6/node:9.3.0-alpine AS build

ENV NODE_ENV=build
WORKDIR /build

RUN apk update && apk add python make g++

COPY package.json yarn.lock /build/
RUN yarn install

COPY . /build/
RUN yarn build && \
    yarn install --production --no-optional && \
    mkdir /app && \
    mv package.json yarn.lock node_modules dist /app

FROM arm32v6/node:9.3.0-alpine

ENV NODE_ENV=production
WORKDIR /app

COPY --from=build /app /app

CMD ["yarn","start"]
